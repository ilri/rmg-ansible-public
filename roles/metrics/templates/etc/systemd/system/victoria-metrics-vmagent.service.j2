[Unit]
Description=A tiny but mighty agent which helps you collect metrics from various sources and store them in VictoriaMetrics
After=network.target
ConditionFileIsExecutable={{ victoriametrics_vmagent_binary_path }}

[Service]
Type=simple
User={{ victoriametrics_user }}
Group={{ victoriametrics_group }}
StartLimitBurst=5
StartLimitInterval=0
Restart=on-failure
RestartSec=1
ExecStart={{ victoriametrics_vmagent_binary_path }} \
          -remoteWrite.url={{ victoriametrics_remotewrite_url }} \
          -remoteWrite.maxDiskUsagePerURL={{ victoriametrics_vmagent_buffer }} \
          -remoteWrite.basicAuth.username={{ victoriametrics_vmauth_user }} \
          -remoteWrite.basicAuth.password={{ victoriametrics_vmauth_pass }} \
          -remoteWrite.tlsCAFile={{ victoriametrics_tls_crt_path }} \
          -remoteWrite.tmpDataPath={{ victoriametrics_vmagent_data_path }} \
          -promscrape.config={{ victoriametrics_vmagent_config_path }}
ExecStop=/bin/kill -s SIGTERM $MAINPID
ExecReload=/bin/kill -s SIGHUP $MAINPID
LimitNOFILE=65536
LimitNPROC=32000

[Install]
WantedBy=multi-user.target
